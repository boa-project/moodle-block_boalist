{"version":3,"sources":["../src/main.js"],"names":["define","$","ModalFactory","ModalEvents","Templates","chooseview","data","src","manifest","conexion_type","$res","attr","url","$reslink","find","html","get","outerHTML","alternate","entrypoint","alternatebase","id","indexOf","substr","alterpath","about","metadata","technical","format","match","name","e","test","customicon","general","title","none","isdownloadable","init","socialnetworks","each","$resource","on","modalresource","show","request","then","custom","preview","type","score","social","avg","count","downloadable","socialnetworksitems","i","v","replace","encodeURI","item","icon","push","alternates","alt","str","strkey","substring","M","block_boalist","one","length","keywords","join","template","render","setTitle","$html","$rate","params","value","post","done","removeClass","key","element","$element","addClass","promise","create","body","modal","getModal","root","getRoot","hidden","getBody","pause","$iframe"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the block.\n *\n * @package   block_boalist\n * @copyright 2020 David Herney @ BambuCo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/templates'],\n        function($, ModalFactory, ModalEvents, Templates) {\n\n    var chooseview = function(data) {\n\n        var src = '';\n\n        // If it is a external resource.\n        if (data.manifest.conexion_type && data.manifest.conexion_type == 'external') {\n            $res = $('<iframe></iframe>');\n            $res.attr('src', data.manifest.url);\n\n            var $reslink = $('<p><a target=\"_blank\"></a></p>');\n            $reslink.find('a').attr('href', data.manifest.url).html(data.manifest.url);\n\n            return $res.get(0).outerHTML + $reslink.get(0).outerHTML;\n        }\n\n        if (data.manifest.alternate && data.manifest.entrypoint) {\n            var alternatebase;\n            if (data.id.indexOf('/content/') >= 0) {\n                alternatebase = data.id.substr(data.id.indexOf('/content/') + 9);\n            } else {\n                alternatebase = data.manifest.entrypoint;\n            }\n\n            var alterpath = data.about + '/!/.alternate/' + alternatebase + '/';\n\n            if (data.metadata.technical.format.match(/video/gi) ||\n            data.metadata.technical.format.match(/audio/gi) ||\n            data.metadata.technical.format.match(/image/gi)) {\n\n                var name = data.manifest.alternate.find(e => /small/g.test(e));\n\n                if (name) {\n                    src = alterpath + name;\n                } else {\n                    name = data.manifest.alternate.find(e => /medium/g.test(e));\n                    if (name) {\n                        src = alterpath + name;\n                    } else {\n                        src = data.about + '/!/' + data.manifest.entrypoint;\n                    }\n                }\n            } else {\n                name = data.manifest.alternate.find(e => /thumb/g.test(e));\n                if (name) {\n                    src = alterpath + name;\n                } else {\n                    src = data.manifest.customicon;\n                }\n            }\n\n\n        } else {\n            if ('technical' in data.metadata && 'format' in data.metadata.technical &&\n                    (data.metadata.technical.format.match(/video/gi) ||\n                     data.metadata.technical.format.match(/audio/gi) ||\n                     data.metadata.technical.format.match(/image/gi))) {\n                src = data.about + '/!/';\n            } else {\n                src = data.manifest.customicon;\n            }\n        }\n\n        var $res;\n        if (data.metadata.technical && data.metadata.technical.format) {\n            if (data.metadata.technical.format.match(/video/gi)) {\n                $res = $('<video controls><source></source></video>');\n                $res.find('source').attr('src', src).attr('type', data.metadata.technical.format);\n\n            } else if (data.metadata.technical.format.match(/audio/gi)) {\n                $res = $('<audio controls><source></source></audio>');\n                $res.find('source').attr('src', src).attr('type', data.metadata.technical.format);\n\n            } else {\n                $res = $('<img />');\n                $res.attr('src', src).attr('alt', data.metadata.general.title.none);\n            }\n\n        }\n\n        return $res.get(0).outerHTML;\n    };\n\n    var isdownloadable = function(data) {\n        //ToDo: validate by content type.\n        return !data.manifest.conexion_type || data.manifest.conexion_type != 'external';\n    };\n\n    /**\n     * Initialise all for the block.\n     *\n     */\n    var init = function(socialnetworks) {\n        $('.block_boalist .one-resource').each(function() {\n            var $resource = $(this);\n\n            $resource.find('.panel-cover').on('click', function() {\n\n                var modalresource = $resource.data('modal');\n\n                if (modalresource) {\n                    modalresource.show();\n                    return;\n                }\n\n                var request = $.get($resource.data('about'))\n                    .then(function( data ) {\n\n                        data.custom = {};\n                        data.custom.preview = chooseview(data);\n                        data.custom.type = (data.metadata.technical && data.metadata.technical.format) ?\n                                                data.metadata.technical.format : '';\n                        data.custom.score = 'avg' in data.social.score ?\n                                                data.social.score.avg + ' / ' + data.social.score.count : 0;\n                        data.custom.downloadable = isdownloadable(data);\n\n                        var socialnetworksitems = [];\n                        $.each(socialnetworks, function(i, v) {\n                            var url = v.url.replace('{url}', encodeURI(data.about + '/!/'));\n                            url = url.replace('{name}', data.metadata.general.title.none);\n\n                            var item = {};\n                            item.url = url;\n                            item.icon = v.icon;\n                            socialnetworksitems.push(item);\n                        });\n\n                        data.custom.socialnetworks = socialnetworksitems;\n\n                        data.custom.alternates = [];\n                        $.each(data.manifest.alternate, function(i, alt) {\n                            var str;\n                            var strkey = 'alternate_' + alt.substring(0, alt.indexOf('.'));\n\n                            if (strkey in M.str.block_boalist) {\n                                str = M.str.block_boalist['alternate_' + alt.substring(0, alt.indexOf('.'))];\n                            } else {\n                                str = alt;\n                            }\n\n                            var one = {\n                                \"text\": str,\n                                \"url\": data.about + '/!/.alternate/' + data.manifest.entrypoint + '/' + alt\n                            };\n\n                            data.custom.alternates[data.custom.alternates.length] = one;\n                        });\n\n                        if (typeof(data.metadata.general.keywords.none) == 'object') {\n                            data.metadata.general.keywords.none = data.metadata.general.keywords.none.join(', ');\n                        }\n\n                        var template = Templates.render('block_boalist/viewresource', data)\n                            .then(function(html) {\n                                modalresource.setTitle(data.metadata.general.title.none);\n\n                                var $html = $(html);\n\n                                $html.find('[boa-act=\"rate\"]').on('click', function() {\n                                    var $rate = $(this);\n\n                                    var params = { value: $rate.data('value') };\n\n                                    $.post(data.about + '/scores', params, function() {})\n                                        .done(function() {\n                                            $html.find('[boa-act=\"rate\"]').removeClass('active').each(function(key, element) {\n                                                var $element = $(element);\n\n                                                if ($element.data('value') <= $rate.data('value')) {\n                                                    $element.addClass('active');\n                                                }\n                                            });\n                                        }\n                                    );\n\n                                });\n\n                                return $html;\n                            });\n\n                        return template.promise();\n                    }\n                );\n\n                ModalFactory.create({\n                    body: request.promise()\n                })\n                .then(function(modal) {\n                    modalresource = modal;\n                    modal.getModal().addClass('block_boalist-modal');\n                    modal.show();\n\n                    var root = modal.getRoot();\n                    root.on(ModalEvents.hidden, function() {\n\n                        // Stop audio and video when close the window.\n                        $(modal.getBody()).find('video').each(function() {\n                            this.pause();\n                        });\n\n                        $(modal.getBody()).find('audio').each(function() {\n                            this.pause();\n                        });\n\n                        $(modal.getBody()).find('iframe').each(function() {\n                            let $iframe = $(this);\n                            $iframe.attr('src', 'about:blank');\n                            $resource.data('modal', null);\n                        });\n                    });\n\n                    $resource.data('modal', modalresource);\n                });\n\n            });\n        });\n\n    };\n\n    return {\n        init: init\n    };\n});\n"],"file":"main.min.js"}