function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_boalist/main",["jquery","core/modal_factory","core/modal_events","core/templates"],function(a,b,c,d){var e=function(b){var c="";if(b.manifest.conexion_type&&"external"==b.manifest.conexion_type){h=a("<iframe></iframe>");h.attr("src",b.manifest.url);var d=a("<p><a target=\"_blank\"></a></p>");d.find("a").attr("href",b.manifest.url).html(b.manifest.url);return h.get(0).outerHTML+d.get(0).outerHTML}if(b.manifest.alternate&&b.manifest.entrypoint){var e;if(0<=b.id.indexOf("/content/")){e=b.id.substr(b.id.indexOf("/content/")+9)}else{e=b.manifest.entrypoint}var f=b.about+"/!/.alternate/"+e+"/";if(b.metadata.technical.format.match(/video/gi)||b.metadata.technical.format.match(/audio/gi)||b.metadata.technical.format.match(/image/gi)){var g=b.manifest.alternate.find(function(a){return /small/g.test(a)});if(g){c=f+g}else{g=b.manifest.alternate.find(function(a){return /medium/g.test(a)});if(g){c=f+g}else{c=b.about+"/!/"+b.manifest.entrypoint}}}else{g=b.manifest.alternate.find(function(a){return /thumb/g.test(a)});if(g){c=f+g}else{c=b.manifest.customicon}}}else{if("technical"in b.metadata&&"format"in b.metadata.technical&&(b.metadata.technical.format.match(/video/gi)||b.metadata.technical.format.match(/audio/gi)||b.metadata.technical.format.match(/image/gi))){c=b.about+"/!/"}else{c=b.manifest.customicon}}var h;if(b.metadata.technical&&b.metadata.technical.format){if(b.metadata.technical.format.match(/video/gi)){h=a("<video controls><source></source></video>");h.find("source").attr("src",c).attr("type",b.metadata.technical.format)}else if(b.metadata.technical.format.match(/audio/gi)){h=a("<audio controls><source></source></audio>");h.find("source").attr("src",c).attr("type",b.metadata.technical.format)}else{h=a("<img />");h.attr("src",c).attr("alt",b.metadata.general.title.none)}}return h.get(0).outerHTML},f=function(a){return!a.manifest.conexion_type||"external"!=a.manifest.conexion_type};return{init:function init(g){a(".block_boalist .one-resource").each(function(){var h=a(this);h.find(".panel-cover").on("click",function(){var i=h.data("modal");if(i){i.show();return}var j=a.get(h.data("about")).then(function(b){b.custom={};b.custom.preview=e(b);b.custom.type=b.metadata.technical&&b.metadata.technical.format?b.metadata.technical.format:"";b.custom.score="avg"in b.social.score?b.social.score.avg+" / "+b.social.score.count:0;b.custom.downloadable=f(b);var c=[];a.each(g,function(a,d){var e=d.url.replace("{url}",encodeURI(b.about+"/!/"));e=e.replace("{name}",b.metadata.general.title.none);var f={url:e,icon:d.icon};c.push(f)});b.custom.socialnetworks=c;b.custom.alternates=[];a.each(b.manifest.alternate,function(a,c){var d,e="alternate_"+c.substring(0,c.indexOf("."));if(e in M.str.block_boalist){d=M.str.block_boalist["alternate_"+c.substring(0,c.indexOf("."))]}else{d=c}var f={text:d,url:b.about+"/!/.alternate/"+b.manifest.entrypoint+"/"+c};b.custom.alternates[b.custom.alternates.length]=f});if("object"==_typeof(b.metadata.general.keywords.none)){b.metadata.general.keywords.none=b.metadata.general.keywords.none.join(", ")}var h=d.render("block_boalist/viewresource",b).then(function(c){i.setTitle(b.metadata.general.title.none);var d=a(c);d.find("[boa-act=\"rate\"]").on("click",function(){var c=a(this),e={value:c.data("value")};a.post(b.about+"/scores",e,function(){}).done(function(){d.find("[boa-act=\"rate\"]").removeClass("active").each(function(b,d){var e=a(d);if(e.data("value")<=c.data("value")){e.addClass("active")}})})});return d});return h.promise()});b.create({body:j.promise()}).then(function(b){i=b;b.getModal().addClass("block_boalist-modal");b.show();var d=b.getRoot();d.on(c.hidden,function(){a(b.getBody()).find("video").each(function(){this.pause()});a(b.getBody()).find("audio").each(function(){this.pause()});a(b.getBody()).find("iframe").each(function(){var b=a(this);b.attr("src","about:blank");h.data("modal",null)})});h.data("modal",i)})})})}}});
//# sourceMappingURL=main.min.js.map
